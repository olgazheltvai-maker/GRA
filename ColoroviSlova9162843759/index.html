<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=5.0, user-scalable=yes">
    <title>–ú–∞–π—Å—Ç–µ—Ä–Ω—è –°–ª—ñ–≤: –§—ñ–Ω–∞–ª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');

        :root {
            --wall: #fff9c4;
            --wood: #8d6e63;
            --wood-dark: #5d4037;
        }

        body {
            margin: 0; padding: 0;
            background-color: #222;
            font-family: 'Fredoka One', cursive;
            overflow: auto; 
            touch-action: manipulation;
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
        }

        #game-world {
            position: absolute;
            width: 1920px; height: 1080px;
            left: 50%; top: 50%;
            transform-origin: center center;
            overflow: hidden;
            background-color: var(--wall);
            background-image: 
                radial-gradient(#fbc02d 15%, transparent 16%),
                radial-gradient(#fbc02d 15%, transparent 16%);
            background-size: 80px 80px; background-position: 0 0, 40px 40px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* –î–ï–ö–û–† */
        .floor {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 250px;
            background: repeating-linear-gradient(90deg, var(--wood) 0, var(--wood) 30px, var(--wood-dark) 31px, var(--wood-dark) 33px);
            border-top: 15px solid #4e342e;
            box-shadow: inset 0 20px 50px rgba(0,0,0,0.3);
            z-index: 1;
        }
        .decor-item { position: absolute; bottom: 200px; z-index: 5; pointer-events: none; }
        .cup-loc { left: 100px; width: 120px; }
        .tube-loc { right: 150px; width: 140px; transform: rotate(-10deg); bottom: 180px; }

        /* –ü–ï–†–°–û–ù–ê–ñ */
        #char-container {
            position: absolute; left: 200px; bottom: 220px;
            width: 300px; height: 400px; z-index: 10;
            transition: opacity 0.5s;
        }
        #mr-brush {
            width: 100%; height: 100%;
            filter: drop-shadow(0 20px 20px rgba(0,0,0,0.3));
            transform-origin: bottom center;
        }
        @keyframes jump-joy {
            0% { transform: scale(1, 1) translateY(0); }
            10% { transform: scale(1.1, 0.9) translateY(20px); } 
            40% { transform: scale(0.9, 1.1) translateY(-300px); } 
            70% { transform: scale(1.05, 0.95) translateY(0); } 
            85% { transform: scale(0.95, 1.05) translateY(-10px); } 
            100% { transform: scale(1, 1) translateY(0); }
        }
        .jumping { animation: jump-joy 1s ease-in-out; }

        /* –î–û–®–ö–ê */
        #board {
            position: absolute; left: 600px; top: 150px;
            width: 1100px; background: #fff;
            padding: 40px; border-radius: 40px;
            border: 15px solid #5d4037;
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; align-items: center;
            z-index: 10; transition: opacity 0.5s;
        }

        #word-area {
            display: flex; gap: 20px; margin-bottom: 50px; padding: 20px;
            background: #fffDE7; border-radius: 20px; border: 4px solid #fff59d;
            min-height: 150px; flex-wrap: wrap; justify-content: center;
        }

        .slot {
            width: 140px; height: 160px;
            background: white; border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
            position: relative; border: 4px solid #ddd;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .slot.hint-pulse {
            animation: hint-flash 0.5s 2; border-color: #F44336 !important; box-shadow: 0 0 30px #F44336;
        }
        @keyframes hint-flash { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        .slot.empty::after {
            content: '?'; font-size: 60px; color: #ddd;
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border: 6px dashed #ccc; border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
        }
        .slot-letter {
            font-family: 'Verdana', 'Arial', sans-serif;
            font-size: 100px; line-height: 1; font-weight: 900;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

        #palette {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 30px;
            margin-top: 20px; padding-top: 40px; border-top: 5px dashed #d7ccc8; width: 100%;
        }

        .paint-btn {
            width: 110px; height: 110px; border-radius: 50%;
            border: 8px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            font-family: 'Verdana', 'Arial', sans-serif;
            font-size: 50px; font-weight: bold; color: white;
            cursor: pointer; transition: transform 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .paint-btn.selected { 
            transform: scale(1.15) translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            border-color: #333; z-index: 20;
        }

        .controls { width: 100%; display: flex; justify-content: center; margin-top: 40px; gap: 30px; }
        .btn {
            padding: 20px 50px; border: none; border-radius: 50px;
            font-family: inherit; font-size: 36px; cursor: pointer;
            box-shadow: 0 8px 0 rgba(0,0,0,0.2);
        }
        .btn:active { transform: translateY(8px); box-shadow: none; }
        .btn-skip { background: #e0e0e0; color: #555; }
        .btn-next { background: #43a047; color: white; display: none; animation: pulse 1s infinite; }
        @keyframes pulse { 50% { transform: scale(1.05); } }

        #victory-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(255, 255, 255, 0.95); z-index: 50;
            animation: fadeIn 1s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .victory-title {
            font-family: 'Pacifico', cursive; font-size: 200px;
            color: #FFD700; text-shadow: 5px 5px 0 #d32f2f, 10px 10px 20px rgba(0,0,0,0.5);
            margin: 0; animation: bounceTitle 2s infinite;
        }
        @keyframes bounceTitle { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1) rotate(5deg); } }
        .victory-cup { font-size: 250px; margin-top: 50px; animation: floatCup 3s infinite ease-in-out; }
        @keyframes floatCup { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }

        #confetti { position: absolute; left: 0; top: 0; width: 1920px; height: 1080px; pointer-events: none; z-index: 2000; }
    </style>
</head>
<body>

<div id="game-world">
    <div class="floor"></div>
    <div class="decor-item cup-loc">
        <svg viewBox="0 0 100 120">
            <path d="M20,100 L25,40 L75,40 L80,100 Z" fill="#90caf9" stroke="#1565c0" stroke-width="3"/>
            <rect x="35" y="10" width="10" height="90" fill="#ffa726" transform="rotate(-15 40 100)" />
            <rect x="55" y="5" width="10" height="100" fill="#ef5350" transform="rotate(10 60 100)" />
        </svg>
    </div>
    <div class="decor-item tube-loc">
        <svg viewBox="0 0 100 50">
            <path d="M10,10 L80,5 L90,25 L80,45 L10,40 Z" fill="#66bb6a" stroke="#2e7d32" stroke-width="3"/>
            <rect x="0" y="15" width="10" height="20" fill="#333" />
        </svg>
    </div>

    <div id="char-container">
        <svg id="mr-brush" viewBox="0 0 100 160">
            <rect x="30" y="70" width="40" height="80" rx="5" fill="#ff7043" stroke="#d84315" stroke-width="3"/>
            <rect x="25" y="40" width="50" height="30" rx="3" fill="#cfd8dc" stroke="#90a4ae" stroke-width="3"/>
            <path d="M25,40 Q15,0 50,0 Q85,0 75,40 Z" fill="#5d4037" stroke="#3e2723" stroke-width="2"/>
            <g id="face">
                <circle cx="40" cy="60" r="6" fill="white" />
                <circle class="pupil" cx="40" cy="60" r="2.5" fill="black" />
                <circle cx="60" cy="60" r="6" fill="white" />
                <circle class="pupil" cx="60" cy="60" r="2.5" fill="black" />
                <path id="mouth" d="M40,85 Q50,90 60,85" fill="none" stroke="#3e2723" stroke-width="3" stroke-linecap="round"/>
            </g>
            <path d="M30,100 Q10,80 10,60" fill="none" stroke="#ff7043" stroke-width="4" stroke-linecap="round"/>
            <path d="M70,100 Q90,80 90,60" fill="none" stroke="#ff7043" stroke-width="4" stroke-linecap="round"/>
        </svg>
    </div>

    <div id="board">
        <div id="word-area"></div>
        <div id="palette"></div>
        <div class="controls">
            <button class="btn btn-skip" onclick="skipLevel()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
            <button class="btn btn-next" onclick="nextLevel()">–î–ê–õ–Ü ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="victory-screen">
        <h1 class="victory-title">–ü–ï–†–ï–ú–û–ì–ê!</h1>
        <div class="victory-cup">üèÜ</div>
    </div>

    <canvas id="confetti" width="1920" height="1080"></canvas>
</div>

<script>
    const baseColors = [
        { hex: "#e53935", name: "red" }, { hex: "#1976d2", name: "blue" },
        { hex: "#43a047", name: "green" }, { hex: "#fdd835", name: "yellow" },
        { hex: "#8e24aa", name: "purple" }, { hex: "#fb8c00", name: "orange" },
        { hex: "#00acc1", name: "cyan" }, { hex: "#ff4081", name: "pink" }
    ];
    
    // –ë–ê–ó–û–í–ò–ô –°–ü–ò–°–û–ö
    const rawWords = [
        "–§–ê–†–ë–ê", "–ö–û–õ–Ü–†", "–ü–ê–ü–Ü–†", "–ü–õ–Ø–ú–ê", "–ö–í–Ü–¢–ò", 
        "–°–û–ù–¶–ï", "–û–ö–ï–ê–ù", "–ö–†–ê–°–ê", "–®–ö–û–õ–ê", "–õ–Ü–ù–Ü–Ø", 
        "–•–ú–ê–†–ê", "–ö–ù–ò–ì–ê", "–†–£–ß–ö–ê", "–°–ò–ù–Ü–ô", "–ó–û–®–ò–¢"
    ];

    // –§–£–ù–ö–¶–Ü–Ø –ß–ò–°–¢–ö–ò (–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è)
    function cleanWord(word) {
        const map = {
            'A': '–ê', 'B': '–í', 'C': '–°', 'E': '–ï', 'H': '–ù', 'I': '–Ü', 'K': '–ö',
            'M': '–ú', 'O': '–û', 'P': '–†', 'T': '–¢', 'X': '–•', 'Y': '–£', 'i': '—ñ', 'a': '–∞'
        };
        return word.split('').map(c => map[c] || c).join('');
    }

    const words = rawWords.map(cleanWord);
    
    function resizeGame() {
        const gameWorld = document.getElementById('game-world');
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        const scale = Math.min(vw / 1920, vh / 1080) * 0.95;
        gameWorld.style.transform = `translate(-50%, -50%) scale(${scale})`;
    }
    window.addEventListener('resize', resizeGame);
    window.addEventListener('load', resizeGame);
    resizeGame();

    let currentIdx = 0;
    let selectedItem = null;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        
        if(type === 'click') {
            osc.frequency.setValueAtTime(400, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now); osc.stop(now + 0.1);
        } else if(type === 'correct') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        } else if(type === 'error') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now); osc.stop(now + 0.2);
        } else if(type === 'win') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, now);
            osc.frequency.linearRampToValueAtTime(800, now + 0.2);
            osc.frequency.linearRampToValueAtTime(1200, now + 0.4);
            gain.gain.linearRampToValueAtTime(0, now + 0.6);
            osc.start(now); osc.stop(now + 0.6);
        } else if(type === 'boom') {
            osc.type = 'lowpass';
            osc.frequency.setValueAtTime(100, now);
            gain.gain.setValueAtTime(1, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
            osc.start(now); osc.stop(now + 0.5);
        }
    }

    function initLevel() {
        particles = []; 
        if (animationId) { cancelAnimationFrame(animationId); animationId = null; }
        ctx.clearRect(0,0,canvas.width,canvas.height);

        const word = words[currentIdx];
        const area = document.getElementById('word-area');
        const palette = document.getElementById('palette');
        const brush = document.getElementById('mr-brush');

        area.innerHTML = '';
        palette.innerHTML = '';
        document.querySelector('.btn-next').style.display = 'none';
        document.querySelector('.btn-skip').style.display = 'block';
        brush.classList.remove('jumping');
        selectedItem = null;
        setFace('neutral');

        let shuffledColors = [...baseColors].sort(() => Math.random() - 0.5);
        let wordData = word.split('').map((char, i) => ({
            char, 
            color: shuffledColors[i % shuffledColors.length].hex,
            id: i
        }));

        wordData.forEach(item => {
            const slot = document.createElement('div');
            slot.className = 'slot empty';
            slot.dataset.targetId = item.id;
            slot.dataset.char = item.char;
            slot.dataset.color = item.color;
            const style = document.createElement('style');
            style.innerHTML = `.slot.empty[data-target-id="${item.id}"]::after { border-color: ${item.color}; }`;
            slot.appendChild(style);
            slot.onclick = () => tryFill(slot, item);
            area.appendChild(slot);
        });

        const buttons = [...wordData].sort(()=>Math.random()-0.5);
        buttons.forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'paint-btn';
            btn.innerText = item.char;
            btn.style.backgroundColor = item.color;
            // –î–∞–Ω—ñ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
            btn.dataset.char = item.char;
            btn.dataset.color = item.color;
            
            if(item.color === '#fdd835') btn.style.color = '#333';
            
            btn.onclick = () => {
                playSound('click');
                // –ü—Ä–æ—Å—Ç–æ –∑–Ω—ñ–º–∞—î–º–æ —Å—Ç–∞—Ä–µ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —ñ —Å—Ç–∞–≤–∏–º–æ –Ω–æ–≤–µ, –ë–ï–ó –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏ —Å–ª–æ—Ç—ñ–≤
                document.querySelectorAll('.paint-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedItem = { ...item, btn: btn };
            };
            palette.appendChild(btn);
        });
    }

    function tryFill(slot, target) {
        if(!selectedItem) return;
        
        if(selectedItem.color === target.color && selectedItem.char === target.char) {
            playSound('correct');
            slot.classList.remove('empty');
            
            slot.innerHTML = `<span class="slot-letter" style="color:${target.color}">${target.char}</span>`;
            if(target.color === '#fdd835') slot.querySelector('span').style.color = '#fbc02d';
            
            selectedItem.btn.style.visibility = 'hidden';
            selectedItem = null;
            setFace('happy');
            if(!document.querySelector('.slot.empty')) doWin();
        } else {
            playSound('error');
            setFace('sad');
            
            // –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ (–∞–ª–µ –ª—ñ—Ç–µ—Ä–∞ —Ç–∞), –ø–æ–∫–∞–∑—É—î–º–æ —á–µ—Ä–≤–æ–Ω—É –ø–æ–º–∏–ª–∫—É
            if (selectedItem.char === target.char) {
                const realSlot = document.querySelector(`.slot.empty[data-char="${selectedItem.char}"][data-color="${selectedItem.color}"]`);
                if(realSlot) {
                    realSlot.classList.add('hint-pulse'); // –ß–µ—Ä–≤–æ–Ω–µ –±–ª–∏–º–∞–Ω–Ω—è (–ø–æ–º–∏–ª–∫–∞)
                    setTimeout(() => realSlot.classList.remove('hint-pulse'), 1000);
                }
            }
            
            slot.style.transform = "translateX(5px)";
            setTimeout(()=>slot.style.transform="translateX(0)", 100);
            setTimeout(()=>setFace('neutral'), 800);
        }
    }

    function doWin() {
        playSound('win');
        document.querySelector('.btn-next').style.display = 'block';
        document.querySelector('.btn-skip').style.display = 'none';
        
        const brush = document.getElementById('mr-brush');
        brush.classList.remove('jumping');
        void brush.offsetWidth;
        brush.classList.add('jumping');
        setFace('happy');
        
        fireFireworksSeries();

        setTimeout(() => {
            const charContainer = document.getElementById('char-container');
            const centerX = charContainer.offsetLeft + charContainer.offsetWidth / 2;
            const topY = charContainer.offsetTop;
            createExplosion(centerX, topY, 60, 2); 
            playSound('boom');
        }, 400);
    }

    function nextLevel() { 
        currentIdx++;
        if (currentIdx >= words.length) {
            showVictory();
        } else {
            initLevel(); 
        }
    }
    
    function skipLevel() { nextLevel(); }

    function showVictory() {
        document.getElementById('board').style.opacity = '0';
        document.getElementById('char-container').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('board').style.display = 'none';
            document.getElementById('char-container').style.display = 'none';
            document.getElementById('victory-screen').style.display = 'flex';
            
            playSound('win'); // –û–¥–∏–Ω —Ä–∞–∑ –∑–≤—É–∫ –ø–µ—Ä–µ–º–æ–≥–∏
            
            // –î–∞–ª—ñ —Ç—ñ–ª—å–∫–∏ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —Å–∞–ª—é—Ç (–±–µ–∑ –∑–≤—É–∫—É)
            setInterval(() => {
                const randX = Math.random() * 1920;
                const randY = Math.random() * 1080;
                createExplosion(randX, randY);
                // –ó–≤—É–∫ –∫–ª—ñ–∫—É –ø—Ä–∏–±—Ä–∞–Ω–æ!
            }, 500);
        }, 500);
    }

    function setFace(mood) {
        const mouth = document.getElementById('mouth');
        if(mood === 'happy') mouth.setAttribute('d', 'M40,85 Q50,95 60,85');
        else if(mood === 'sad') mouth.setAttribute('d', 'M40,90 Q50,80 60,90');
        else mouth.setAttribute('d', 'M40,85 Q50,90 60,85');
    }

    document.addEventListener('mousemove', e => moveEyes(e.clientX, e.clientY));
    document.addEventListener('touchmove', e => moveEyes(e.touches[0].clientX, e.touches[0].clientY), {passive: true});

    function moveEyes(clientX, clientY) {
        const pupils = document.querySelectorAll('.pupil');
        const face = document.getElementById('face');
        const rect = face.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        const dx = Math.max(-3, Math.min(3, (clientX - cx) / 20));
        const dy = Math.max(-3, Math.min(3, (clientY - cy) / 20));
        pupils.forEach(p => p.setAttribute('transform', `translate(${dx},${dy})`));
    }

    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let animationId = null;

    function createExplosion(x, y, count = 30, speedMultiplier = 1) {
        const color = baseColors[Math.floor(Math.random() * baseColors.length)].hex;
        for (let i = 0; i < count; i++) {
            const angle = (Math.PI * 2 / count) * i;
            const speed = (Math.random() * 8 + 5) * speedMultiplier;
            particles.push({
                x: x, y: y,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                c: color, life: 1.5, gravity: 0.2, size: Math.random()*5 + 4
            });
        }
        if (!animationId) updateParticles();
    }

    function fireFireworksSeries() {
        for(let i=0; i<5; i++) {
            setTimeout(() => {
                const randX = Math.random() * 1400 + 260; 
                const randY = Math.random() * 600 + 100;
                createExplosion(randX, randY);
                if(i > 0) playSound('click'); 
            }, i * 250);
        }
    }

    function updateParticles() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if (particles.length === 0) { animationId = null; return; }

        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.vy += p.gravity; 
            p.life -= 0.015;
            ctx.fillStyle = p.c;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI*2); ctx.fill();
            if(p.life <= 0) { particles.splice(i, 1); }
        }
        animationId = requestAnimationFrame(updateParticles);
    }

    initLevel();
</script>

</body>
</html>