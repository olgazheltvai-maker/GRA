<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –ì–∞–ª—è–≤–∏–Ω–∞ (TRIAL)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            position: fixed;
            font-family: 'Comic Neue', cursive;
        }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† –ì–†–ò */
        #game-container {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 1920px;
            height: 1080px;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,1);
            transform-origin: center center;
            transform: translate(-50%, -50%) scale(1);
        }

        /* --- –í–û–î–Ø–ù–ò–ô –ó–ù–ê–ö (–®–£–ú) --- */
        #watermark-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9000; /* –ü–æ–≤–µ—Ä—Ö —É—Å—å–æ–≥–æ –≤ –≥—Ä—ñ */
            pointer-events: none; /* –ü—Ä–æ–ø—É—Å–∫–∞—î –∫–ª—ñ–∫–∏ –∫—Ä—ñ–∑—å —Å–µ–±–µ */
            display: flex;
            flex-wrap: wrap;
            align-content: center;
            justify-content: center;
            overflow: hidden;
            opacity: 0.6;
        }

        .wm-item {
            font-size: 3rem;
            color: rgba(0, 0, 0, 0.15); /* –ù–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π —á–æ—Ä–Ω–∏–π */
            transform: rotate(-30deg);
            margin: 40px;
            user-select: none;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* --- –ß–û–†–ù–ò–ô –ï–ö–†–ê–ù –ë–õ–û–ö–£–í–ê–ù–ù–Ø --- */
        #trial-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: black;
            z-index: 20000; /* –ù–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç */
            display: none; /* –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        #trial-text {
            font-size: 2rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #trial-countdown {
            font-size: 4rem;
            color: #FFCA28;
            font-weight: bold;
        }

        /* --- –î–ï–ö–û–†–ê–¶–Ü–á --- */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50px;
            animation: floatClouds 60s linear infinite;
            z-index: 1;
        }
        .cloud::after, .cloud::before { content: ''; position: absolute; background: inherit; border-radius: 50%; }
        
        .c1 { width: 120px; height: 50px; top: 10%; left: -150px; animation-duration: 45s; }
        .c1::after { width: 50px; height: 50px; top: -25px; left: 15px; }
        .c1::before { width: 40px; height: 40px; top: -15px; left: 60px; }

        .c2 { width: 180px; height: 70px; top: 20%; left: -200px; animation-duration: 65s; animation-delay: 5s; }
        .c2::after { width: 70px; height: 70px; top: -35px; left: 25px; }
        .c2::before { width: 60px; height: 60px; top: -25px; left: 90px; }

        @keyframes floatClouds {
            from { transform: translateX(-300px); }
            to { transform: translateX(2000px); }
        }

        .hill { position: absolute; bottom: -50px; border-radius: 100% 100% 0 0; }
        .hill-1 { width: 70%; height: 45%; left: -10%; background: #66BB6A; z-index: 2; }
        .hill-2 { width: 80%; height: 55%; right: -20%; background: #43A047; z-index: 3; }

        .tree {
            position: absolute;
            bottom: 250px; 
            z-index: 4; 
            font-size: 24rem; 
            filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.4));
            pointer-events: none;
        }
        .tree-1 { left: -20px; transform: rotate(-5deg); }
        .tree-2 { right: 80px; bottom: 350px; transform: rotate(5deg); }

        /* --- –Ü–ù–¢–ï–†–§–ï–ô–° --- */
        #task-panel {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 50px;
            border-radius: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            text-align: center;
            z-index: 100;
            border: 8px solid #fff;
            min-width: 800px;
        }

        #task-text { font-size: 2.5rem; color: #444; margin-bottom: 30px; }

        #round-target {
            cursor: pointer; border-bottom: 3px dashed currentColor;
            transition: transform 0.1s; display: inline-block;
        }
        #round-target:active { transform: scale(0.95); }

        #game-area {
            display: flex; align-items: center; justify-content: center;
            gap: 25px; margin-bottom: 30px;
        }

        .inequality-sign { font-size: 4rem; color: #999; font-weight: bold; }

        #number-display {
            font-size: 6rem; color: #333; font-weight: bold;
            cursor: pointer; padding: 0 20px;
            border-bottom: 4px dashed #ccc; min-width: 150px;
        }
        
        #edit-number-input {
            font-size: 4rem; width: 180px; text-align: center; display: none;
            border: 3px solid #2196F3; border-radius: 15px;
        }

        input[type="number"] {
            font-size: 3.5rem; padding: 15px; width: 180px;
            border: 5px solid #FFCA28; border-radius: 20px;
            text-align: center; outline: none;
            background: #FFF9C4; color: #333; transition: 0.3s;
            font-family: 'Comic Neue', cursive;
        }
        input[type="number"]:focus { border-color: #FF6F00; transform: scale(1.05); }
        
        .input-error {
            border-color: #e53935 !important; background-color: #ffcdd2 !important;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px); }
            75% { transform: translateX(15px); }
        }

        .btn {
            font-size: 2rem; padding: 15px 50px;
            border: none; border-radius: 60px;
            cursor: pointer; font-family: inherit; font-weight: bold;
            transition: 0.2s; margin: 0 10px;
        }
        .btn-check { background-color: #66BB6A; color: white; box-shadow: 0 8px 0 #388E3C; }
        .btn-check:active { transform: translateY(4px); box-shadow: none; }
        .btn-next { background-color: #29B6F6; color: white; box-shadow: 0 8px 0 #0277BD; display: none; }
        .btn-regen {
            background-color: #FF9800; color: white; padding: 15px 20px;
            font-size: 2rem; box-shadow: 0 8px 0 #F57C00;
        }
        .btn-regen:active { transform: translateY(4px); box-shadow: none; }

        /* --- –ö–í–Ü–¢–ò --- */
        .flower {
            position: absolute; font-size: 5rem; z-index: 5;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
            transform-origin: bottom center;
            animation: sway 3s ease-in-out infinite alternate;
        }
        .f1 { left: 15%; bottom: 120px; animation-delay: 0s; font-size: 6rem; }
        .f2 { left: 30%; bottom: 80px; animation-delay: 1s; }
        .f3 { left: 50%; bottom: 150px; animation-delay: 2s; font-size: 5.5rem; }
        .f4 { left: 70%; bottom: 60px; animation-delay: 0.5s; }
        .f5 { left: 85%; bottom: 140px; animation-delay: 1.5s; font-size: 6.5rem; }

        @keyframes sway { 0% { transform: rotate(-6deg); } 100% { transform: rotate(6deg); } }

        #butterfly {
            position: absolute; font-size: 8rem; z-index: 50;
            filter: drop-shadow(0 15px 20px rgba(0,0,0,0.3));
            pointer-events: none;
        }

        .particle {
            position: absolute; width: 20px; height: 20px; border-radius: 50%;
            z-index: 999; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="watermark-layer"></div>

        <div class="cloud c1"></div>
        <div class="cloud c2"></div>
        <div class="hill hill-1"></div>
        <div class="hill hill-2"></div>
        <div class="tree tree-1">üå≥</div>
        <div class="tree tree-2">üå≤</div>
        <div class="flower f1">üåº</div>
        <div class="flower f2">üå∑</div>
        <div class="flower f3">üåª</div>
        <div class="flower f4">üå∫</div>
        <div class="flower f5">üåπ</div>
        <div id="butterfly">ü¶ã</div>

        <div id="task-panel">
            <div id="task-text">
                –°—É—Å—ñ–¥–Ω—ñ <span id="round-target" onclick="toggleMode()" title="–ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è">...</span>
            </div>
            <div id="game-area">
                <input type="number" id="input-left" placeholder="?">
                <span class="inequality-sign">&lt;</span>
                <div id="number-wrapper" style="display:inline-block">
                    <div id="number-display" title="–ö–ª—ñ–∫–Ω–∏, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ —á–∏—Å–ª–æ">000</div>
                    <input type="number" id="edit-number-input">
                </div>
                <span class="inequality-sign">&lt;</span>
                <input type="number" id="input-right" placeholder="?">
                <button class="btn btn-regen" onclick="generateTask(true)" title="–Ü–Ω—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è">üîÑ</button>
            </div>
            <button class="btn btn-check" onclick="checkAnswer()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
            <button class="btn btn-next" onclick="nextTask()" id="next-btn">–î–∞–ª—ñ ‚û°</button>
        </div>
    </div>

    <div id="trial-overlay">
        <div id="trial-text">–ü—Ä–æ–±–Ω–∞ –≤–µ—Ä—Å—ñ—è<br>–ì—Ä–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å—Å—è —á–µ—Ä–µ–∑:</div>
        <div id="trial-countdown">5</div>
    </div>

<script>
    // --- –ì–ï–ù–ï–†–ê–¶–Ü–Ø –í–û–î–Ø–ù–ò–• –ó–ù–ê–ö–Ü–í ---
    function initWatermark() {
        const wmLayer = document.getElementById('watermark-layer');
        // –°—Ç–≤–æ—Ä—é—î–º–æ 80 –Ω–∞–ø–∏—Å—ñ–≤, —â–æ–± –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –≤–µ—Å—å –µ–∫—Ä–∞–Ω 1920x1080
        for(let i=0; i<80; i++) {
            const el = document.createElement('div');
            el.className = 'wm-item';
            el.innerText = '–ü–†–û–ë–ù–ê –í–ï–†–°–Ü–Ø';
            wmLayer.appendChild(el);
        }
    }

    // --- –õ–û–ì–Ü–ö–ê –ë–õ–û–ö–£–í–ê–ù–ù–Ø (–ö–û–ñ–ù–Ü 15 –°–ï–ö) ---
    function startTrialLogic() {
        const overlay = document.getElementById('trial-overlay');
        const countdownEl = document.getElementById('trial-countdown');
        let timeLeft = 5;

        // –ó–∞–ø—É—Å–∫ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –∫–æ–∂–Ω—ñ 15 —Å–µ–∫—É–Ω–¥ + 5 —Å–µ–∫—É–Ω–¥ –ø–æ–∫–∞–∑ = —Ü–∏–∫–ª 20 —Å–µ–∫—É–Ω–¥
        // –ê–ª–µ –ø—Ä–æ—Å–∏–ª–∏ "–∫–æ–∂–Ω—ñ 15 —Å–µ–∫—É–Ω–¥ –∑'—è–≤–ª—è–≤—Å—è", —Ç–æ–º—É —ñ–Ω—Ç–µ—Ä–≤–∞–ª —Å—Ç–∞–≤–∏–º–æ 15000
        setInterval(() => {
            overlay.style.display = 'flex';
            timeLeft = 5;
            countdownEl.innerText = timeLeft;

            const timer = setInterval(() => {
                timeLeft--;
                countdownEl.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    overlay.style.display = 'none';
                }
            }, 1000);

        }, 15000); // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ—è–≤–∏ (15000 –º—Å)
    }

    // --- –ú–ê–°–®–¢–ê–ë–£–í–ê–ù–ù–Ø ---
    function fitGameToScreen() {
        const container = document.getElementById('game-container');
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
        const baseW = 1920;
        const baseH = 1080;
        const scale = Math.min(vw / baseW, vh / baseH) * 0.9;
        container.style.transform = `translate(-50%, -50%) scale(${scale})`;
    }

    window.addEventListener('load', () => {
        fitGameToScreen();
        initWatermark(); // –°—Ç–≤–æ—Ä—é—î–º–æ —à—É–º
        startTrialLogic(); // –ó–∞–ø—É—Å–∫–∞—î–º–æ –Ω–∞–±—Ä–∏–¥–ª–∏–≤–∏–π —Ç–∞–π–º–µ—Ä
    });
    window.addEventListener('resize', () => {
        fitGameToScreen();
        setTimeout(fitGameToScreen, 100);
    });
    window.addEventListener('orientationchange', () => {
        fitGameToScreen();
        setTimeout(fitGameToScreen, 200);
        setTimeout(fitGameToScreen, 500);
    });


    // --- –ó–í–£–ö –¢–ê –õ–û–ì–Ü–ö–ê (–ë–ï–ó –ó–ú–Ü–ù) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const now = audioCtx.currentTime;
        if (type === 'success') {
            const notes = [523.25, 659.25, 783.99, 1046.50];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.1, now + 0.05); 
                gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.08); osc.stop(now + 2);
            });
        } else if (type === 'error') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.3);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(); osc.stop(now + 0.4);
        }
    }

    let currentNumber = 0;
    let currentTarget = 'tens';
    let currentFlowerIndex = 0;
    
    const flowers = document.querySelectorAll('.flower');
    const butterfly = document.getElementById('butterfly');
    const numberDisplay = document.getElementById('number-display');
    const editInput = document.getElementById('edit-number-input');
    const inputLeft = document.getElementById('input-left');
    const inputRight = document.getElementById('input-right');
    const targetText = document.getElementById('round-target');

    function init() {
        fitGameToScreen();
        const start = flowers[Math.floor(Math.random() * flowers.length)];
        currentFlowerIndex = Array.from(flowers).indexOf(start);
        landButterflyOn(start, 0);
        generateTask(true);
    }

    function flyToRandomFlower() {
        let nextIndex;
        do { nextIndex = Math.floor(Math.random() * flowers.length); } while (nextIndex === currentFlowerIndex);
        currentFlowerIndex = nextIndex;
        
        const airX = Math.random() * (1920 - 200) + 100;
        const airY = Math.random() * (1080 / 2);
        
        butterfly.style.transition = "all 1.5s ease-in-out";
        butterfly.style.left = `${airX}px`;
        butterfly.style.top = `${airY}px`;
        butterfly.style.transform = `scale(1.2) rotate(${Math.random() * 30 - 15}deg)`;

        setTimeout(() => landButterflyOn(flowers[nextIndex], 1.5), 1200);
    }

    function landButterflyOn(flower, duration) {
        const tx = flower.offsetLeft + (flower.offsetWidth / 2) - (butterfly.offsetWidth / 2);
        const ty = flower.offsetTop - 80;
        butterfly.style.transition = `all ${duration}s cubic-bezier(0.25, 1, 0.5, 1)`;
        butterfly.style.left = `${tx}px`;
        butterfly.style.top = `${ty}px`;
        butterfly.style.transform = `scale(1) rotate(0deg)`;
    }

    function generateTask(randomizeMode = true) {
        inputLeft.value = ''; inputRight.value = '';
        inputLeft.className = ''; inputRight.className = '';
        document.querySelector('.btn-check').style.display = 'inline-block';
        document.getElementById('next-btn').style.display = 'none';

        if (randomizeMode) {
            currentTarget = Math.random() < 0.5 ? 'tens' : 'hundreds';
        }
        updateTargetVisuals();
        generateNumberForMode();
        inputLeft.focus();
    }

    function updateTargetVisuals() {
        if (currentTarget === 'tens') {
            targetText.innerText = "–î–ï–°–Ø–¢–ö–ò";
            targetText.style.color = "#E91E63"; 
        } else {
            targetText.innerText = "–°–û–¢–ù–Ü";
            targetText.style.color = "#1565C0"; 
        }
    }

    function generateNumberForMode() {
        if (currentTarget === 'tens') {
            do { currentNumber = Math.floor(Math.random() * 980) + 10; } while (currentNumber % 10 === 0);
        } else {
            do { currentNumber = Math.floor(Math.random() * 890) + 100; } while (currentNumber % 100 === 0);
        }
        updateNumberDisplay(currentNumber);
    }

    function toggleMode() {
        currentTarget = (currentTarget === 'tens') ? 'hundreds' : 'tens';
        updateTargetVisuals();
        generateNumberForMode(); 
        inputLeft.value = ''; inputRight.value = '';
        inputLeft.className = ''; inputRight.className = '';
        document.querySelector('.btn-check').style.display = 'inline-block';
        document.getElementById('next-btn').style.display = 'none';
    }

    function updateNumberDisplay(num) {
        currentNumber = parseInt(num);
        numberDisplay.innerText = currentNumber;
    }
    numberDisplay.addEventListener('click', () => {
        numberDisplay.style.display = 'none';
        editInput.style.display = 'inline-block';
        editInput.value = currentNumber;
        editInput.focus();
    });
    editInput.addEventListener('blur', () => {
        let val = parseInt(editInput.value);
        if (!isNaN(val) && val > 0 && val < 1000) updateNumberDisplay(val);
        editInput.style.display = 'none';
        numberDisplay.style.display = 'inline-block';
    });
    editInput.addEventListener('keypress', (e) => { if(e.key==='Enter') editInput.blur(); });

    function checkAnswer() {
        const valLeft = parseInt(inputLeft.value);
        const valRight = parseInt(inputRight.value);
        let cL, cR;
        if (currentTarget === 'tens') {
            cL = Math.floor(currentNumber / 10) * 10; cR = cL + 10;
        } else {
            cL = Math.floor(currentNumber / 100) * 100; cR = cL + 100;
        }
        let isCorrect = (valLeft === cL && valRight === cR);
        if (isCorrect) {
            playSound('success');
            createFireworks();
            flyToRandomFlower();
            document.querySelector('.btn-check').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            document.getElementById('next-btn').focus();
            inputLeft.className = ''; inputRight.className = '';
        } else {
            playSound('error');
            if (valLeft !== cL) inputLeft.classList.add('input-error');
            if (valRight !== cR) inputRight.classList.add('input-error');
            setTimeout(() => { inputLeft.className=''; inputRight.className=''; }, 500);
        }
    }

    function createFireworks() {
        const colors = ['#FFEB3B', '#FF4081', '#00E676', '#03A9F4'];
        const taskPanel = document.getElementById('task-panel');
        const gameArea = document.getElementById('game-area');
        const cx = taskPanel.offsetLeft + gameArea.offsetLeft + (gameArea.offsetWidth / 2);
        const cy = taskPanel.offsetTop + gameArea.offsetTop + (gameArea.offsetHeight / 2);
        const container = document.getElementById('game-container');

        for (let i = 0; i < 50; i++) {
            const p = document.createElement('div');
            p.classList.add('particle');
            container.appendChild(p);
            p.style.background = colors[Math.floor(Math.random()*colors.length)];
            p.style.left = cx+'px'; p.style.top = cy+'px';
            const angle = Math.random()*Math.PI*2;
            const vel = 10 + Math.random()*20;
            const vx = Math.cos(angle)*vel; const vy = Math.sin(angle)*vel;
            p.animate([
                { transform: `translate(0,0)`, opacity: 1 },
                { transform: `translate(${vx*20}px, ${vy*20+150}px)`, opacity: 0 }
            ], { duration: 1000, easing: 'ease-out' }).onfinish = () => p.remove();
        }
    }

    function nextTask() { generateTask(true); }

    inputLeft.addEventListener('keypress', (e)=>{if(e.key==='Enter') inputRight.focus();});
    inputRight.addEventListener('keypress', (e)=>{if(e.key==='Enter') checkAnswer();});
    
    window.onload = function() {
        init();
    };
</script>
</body>
</html>