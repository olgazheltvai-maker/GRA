<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=5.0, user-scalable=yes">
    <title>–ú–∞–π—Å—Ç–µ—Ä–Ω—è –°–ª—ñ–≤: –§—ñ–Ω–∞–ª (Trial)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');

        :root {
            --wall: #fff9c4;
            --wood: #8d6e63;
            --wood-dark: #5d4037;
        }

        body {
            margin: 0; padding: 0;
            background-color: #222;
            font-family: 'Fredoka One', cursive;
            overflow: hidden; 
            touch-action: manipulation;
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
        }

        #game-world {
            position: absolute;
            width: 1920px; height: 1080px;
            left: 50%; top: 50%;
            transform-origin: center center;
            overflow: hidden;
            background-color: var(--wall);
            background-image: 
                radial-gradient(#fbc02d 15%, transparent 16%),
                radial-gradient(#fbc02d 15%, transparent 16%);
            background-size: 80px 80px; background-position: 0 0, 40px 40px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* –ï–§–ï–ö–¢–ò –ü–†–û–ë–ù–û–á –í–ï–†–°–Ü–á */
        #watermark-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: flex; flex-wrap: wrap;
            justify-content: space-around; align-content: space-around;
            opacity: 0.1;
        }
        .watermark-text {
            font-size: 80px; transform: rotate(-30deg);
            color: #000; white-space: nowrap; user-select: none;
        }

        #trial-interruption {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black; color: white;
            display: none; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 3000; font-family: sans-serif;
        }
        .trial-msg { font-size: 80px; color: #ff5252; margin-bottom: 20px; font-weight: bold; }
        .trial-sub { font-size: 40px; color: #ccc; }

        /* –î–ï–ö–û–† */
        .floor {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 250px;
            background: repeating-linear-gradient(90deg, var(--wood) 0, var(--wood) 30px, var(--wood-dark) 31px, var(--wood-dark) 33px);
            border-top: 15px solid #4e342e;
            box-shadow: inset 0 20px 50px rgba(0,0,0,0.3);
            z-index: 1;
        }
        .decor-item { position: absolute; bottom: 200px; z-index: 5; pointer-events: none; }
        .cup-loc { left: 100px; width: 120px; }
        .tube-loc { right: 150px; width: 140px; transform: rotate(-10deg); bottom: 180px; }

        /* –ü–ï–†–°–û–ù–ê–ñ */
        #char-container {
            position: absolute; left: 200px; bottom: 220px;
            width: 300px; height: 400px; z-index: 10;
            transition: opacity 0.5s;
        }
        #mr-brush {
            width: 100%; height: 100%;
            filter: drop-shadow(0 20px 20px rgba(0,0,0,0.3));
            transform-origin: bottom center;
        }
        @keyframes jump-joy {
            0% { transform: scale(1, 1) translateY(0); }
            10% { transform: scale(1.1, 0.9) translateY(20px); } 
            40% { transform: scale(0.9, 1.1) translateY(-300px); } 
            70% { transform: scale(1.05, 0.95) translateY(0); } 
            85% { transform: scale(0.95, 1.05) translateY(-10px); } 
            100% { transform: scale(1, 1) translateY(0); }
        }
        .jumping { animation: jump-joy 1s ease-in-out; }

        /* –î–û–®–ö–ê */
        #board {
            position: absolute; left: 600px; top: 150px;
            width: 1100px; background: #fff;
            padding: 40px; border-radius: 40px;
            border: 15px solid #5d4037;
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; align-items: center;
            z-index: 10; transition: opacity 0.5s;
        }

        #word-area {
            display: flex; gap: 20px; margin-bottom: 50px; padding: 20px;
            background: #fffDE7; border-radius: 20px; border: 4px solid #fff59d;
            min-height: 150px; flex-wrap: wrap; justify-content: center;
        }

        .slot {
            width: 140px; height: 160px;
            background: white; border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
            position: relative; border: 4px solid #ddd;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .slot.hint-pulse {
            animation: hint-flash 0.5s 2; border-color: #F44336 !important; box-shadow: 0 0 30px #F44336;
        }
        @keyframes hint-flash { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        .slot.empty::after {
            content: '?'; font-size: 60px; color: #ddd;
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border: 6px dashed #ccc; border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
        }
        .slot-letter {
            font-family: 'Verdana', 'Arial', sans-serif;
            font-size: 100px; line-height: 1; font-weight: 900;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

        #palette {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 30px;
            margin-top: 20px; padding-top: 40px; border-top: 5px dashed #d7ccc8; width: 100%;
        }

        .paint-btn {
            width: 110px; height: 110px; border-radius: 50%;
            border: 8px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            font-family: 'Verdana', 'Arial', sans-serif;
            font-size: 50px; font-weight: bold; color: white;
            cursor: pointer; transition: transform 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .paint-btn.selected { 
            transform: scale(1.15) translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            border-color: #333; z-index: 20;
        }

        .controls { width: 100%; display: flex; justify-content: center; margin-top: 40px; gap: 30px; }
        .btn {
            padding: 20px 50px; border: none; border-radius: 50px;
            font-family: inherit; font-size: 36px; cursor: pointer;
            box-shadow: 0 8px 0 rgba(0,0,0,0.2);
        }
        .btn:active { transform: translateY(8px); box-shadow: none; }
        .btn-skip { background: #e0e0e0; color: #555; }
        .btn-next { background: #43a047; color: white; display: none; animation: pulse 1s infinite; }
        @keyframes pulse { 50% { transform: scale(1.05); } }

        #victory-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(255, 255, 255, 0.95); z-index: 50;
            animation: fadeIn 1s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .victory-title {
            font-family: 'Pacifico', cursive; font-size: 200px;
            color: #FFD700; text-shadow: 5px 5px 0 #d32f2f, 10px 10px 20px rgba(0,0,0,0.5);
            margin: 0; animation: bounceTitle 2s infinite;
        }
        @keyframes bounceTitle { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1) rotate(5deg); } }
        .victory-cup { font-size: 250px; margin-top: 50px; animation: floatCup 3s infinite ease-in-out; }
        @keyframes floatCup { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }

        #confetti { position: absolute; left: 0; top: 0; width: 1920px; height: 1080px; pointer-events: none; z-index: 2000; }
    </style>
</head>
<body>

<div id="game-world">
    <div id="watermark-overlay"></div>
    <div id="trial-interruption">
        <div class="trial-msg">–ü–†–û–ë–ù–ê –í–ï–†–°–Ü–Ø</div>
        <div class="trial-sub">–ì—Ä–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –¥–µ–∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥...</div>
    </div>

    <div class="floor"></div>
    <div class="decor-item cup-loc">
        <svg viewBox="0 0 100 120">
            <path d="M20,100 L25,40 L75,40 L80,100 Z" fill="#90caf9" stroke="#1565c0" stroke-width="3"/>
            <rect x="35" y="10" width="10" height="90" fill="#ffa726" transform="rotate(-15 40 100)" />
            <rect x="55" y="5" width="10" height="100" fill="#ef5350" transform="rotate(10 60 100)" />
        </svg>
    </div>
    <div class="decor-item tube-loc">
        <svg viewBox="0 0 100 50">
            <path d="M10,10 L80,5 L90,25 L80,45 L10,40 Z" fill="#66bb6a" stroke="#2e7d32" stroke-width="3"/>
            <rect x="0" y="15" width="10" height="20" fill="#333" />
        </svg>
    </div>

    <div id="char-container">
        <svg id="mr-brush" viewBox="0 0 100 160">
            <rect x="30" y="70" width="40" height="80" rx="5" fill="#ff7043" stroke="#d84315" stroke-width="3"/>
            <rect x="25" y="40" width="50" height="30" rx="3" fill="#cfd8dc" stroke="#90a4ae" stroke-width="3"/>
            <path d="M25,40 Q15,0 50,0 Q85,0 75,40 Z" fill="#5d4037" stroke="#3e2723" stroke-width="2"/>
            <g id="face">
                <circle cx="40" cy="60" r="6" fill="white" />
                <circle class="pupil" cx="40" cy="60" r="2.5" fill="black" />
                <circle cx="60" cy="60" r="6" fill="white" />
                <circle class="pupil" cx="60" cy="60" r="2.5" fill="black" />
                <path id="mouth" d="M40,85 Q50,90 60,85" fill="none" stroke="#3e2723" stroke-width="3" stroke-linecap="round"/>
            </g>
            <path d="M30,100 Q10,80 10,60" fill="none" stroke="#ff7043" stroke-width="4" stroke-linecap="round"/>
            <path d="M70,100 Q90,80 90,60" fill="none" stroke="#ff7043" stroke-width="4" stroke-linecap="round"/>
        </svg>
    </div>

    <div id="board">
        <div id="word-area"></div>
        <div id="palette"></div>
        <div class="controls">
            <button class="btn btn-skip" onclick="skipLevel()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
            <button class="btn btn-next" onclick="nextLevel()">–î–ê–õ–Ü ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="victory-screen">
        <h1 class="victory-title">–ü–ï–†–ï–ú–û–ì–ê!</h1>
        <div class="victory-cup">üèÜ</div>
    </div>

    <canvas id="confetti" width="1920" height="1080"></canvas>
</div>

<script>
    // --- –ü–†–û–ë–ù–ê –í–ï–†–°–Ü–Ø: –õ–û–ì–Ü–ö–ê ---
    function initTrialEffects() {
        const overlay = document.getElementById('watermark-overlay');
        for (let i = 0; i < 30; i++) {
            const div = document.createElement('div');
            div.className = 'watermark-text';
            div.innerText = '–ü–†–û–ë–ù–ê –í–ï–†–°–Ü–Ø';
            overlay.appendChild(div);
        }

        setInterval(() => {
            const screen = document.getElementById('trial-interruption');
            screen.style.display = 'flex';
            setTimeout(() => {
                screen.style.display = 'none';
            }, 2000);
        }, 15000);
    }

    // --- –û–°–ù–û–í–ù–ê –ì–†–ê ---
    const baseColors = [
        { hex: "#e53935", name: "red" }, { hex: "#1976d2", name: "blue" },
        { hex: "#43a047", name: "green" }, { hex: "#fdd835", name: "yellow" },
        { hex: "#8e24aa", name: "purple" }, { hex: "#fb8c00", name: "orange" },
        { hex: "#00acc1", name: "cyan" }, { hex: "#ff4081", name: "pink" }
    ];
    
    const rawWords = ["–§–ê–†–ë–ê", "–ö–û–õ–Ü–†", "–ü–ê–ü–Ü–†", "–ü–õ–Ø–ú–ê", "–ö–í–Ü–¢–ò", "–°–û–ù–¶–ï", "–û–ö–ï–ê–ù", "–ö–†–ê–°–ê", "–®–ö–û–õ–ê", "–õ–Ü–ù–Ü–Ø"];

    function cleanWord(word) {
        const map = { 'A':'–ê','B':'–í','C':'–°','E':'–ï','H':'–ù','I':'–Ü','K':'–ö','M':'–ú','O':'–û','P':'–†','T':'–¢','X':'–•','Y':'–£' };
        return word.split('').map(c => map[c] || c).join('');
    }

    const words = rawWords.map(cleanWord);
    let currentIdx = 0;
    let selectedItem = null;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function resizeGame() {
        const gameWorld = document.getElementById('game-world');
        const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080) * 0.95;
        gameWorld.style.transform = `translate(-50%, -50%) scale(${scale})`;
    }
    window.addEventListener('resize', resizeGame);
    resizeGame();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if(type === 'click') {
            osc.frequency.setValueAtTime(400, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now); osc.stop(now + 0.1);
        } else if(type === 'correct') {
            osc.type = 'triangle'; osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
        } else if(type === 'error') {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(200, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now); osc.stop(now + 0.2);
        } else if(type === 'win') {
            osc.type = 'sine'; osc.frequency.setValueAtTime(500, now);
            osc.frequency.linearRampToValueAtTime(1200, now + 0.4);
            gain.gain.linearRampToValueAtTime(0, now + 0.6);
            osc.start(now); osc.stop(now + 0.6);
        }
    }

    function initLevel() {
        particles = [];
        const word = words[currentIdx];
        const area = document.getElementById('word-area');
        const palette = document.getElementById('palette');
        area.innerHTML = ''; palette.innerHTML = '';
        document.querySelector('.btn-next').style.display = 'none';
        document.querySelector('.btn-skip').style.display = 'block';
        selectedItem = null;
        setFace('neutral');

        let shuffledColors = [...baseColors].sort(() => Math.random() - 0.5);
        let wordData = word.split('').map((char, i) => ({
            char, color: shuffledColors[i % shuffledColors.length].hex, id: i
        }));

        wordData.forEach(item => {
            const slot = document.createElement('div');
            slot.className = 'slot empty';
            slot.dataset.char = item.char;
            slot.dataset.color = item.color;
            slot.style.borderColor = item.color;
            slot.onclick = () => tryFill(slot, item);
            area.appendChild(slot);
        });

        [...wordData].sort(()=>Math.random()-0.5).forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'paint-btn';
            btn.innerText = item.char;
            btn.style.backgroundColor = item.color;
            if(item.color === '#fdd835') btn.style.color = '#333';
            btn.onclick = () => {
                playSound('click');
                document.querySelectorAll('.paint-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedItem = { ...item, btn: btn };
            };
            palette.appendChild(btn);
        });
    }

    function tryFill(slot, target) {
        if(!selectedItem) return;
        if(selectedItem.color === target.color && selectedItem.char === target.char) {
            playSound('correct');
            slot.classList.remove('empty');
            slot.innerHTML = `<span class="slot-letter" style="color:${target.color}">${target.char}</span>`;
            selectedItem.btn.style.visibility = 'hidden';
            selectedItem = null;
            setFace('happy');
            if(!document.querySelector('.slot.empty')) doWin();
        } else {
            playSound('error');
            setFace('sad');
            slot.style.transform = "translateX(5px)";
            setTimeout(()=>slot.style.transform="translateX(0)", 100);
            setTimeout(()=>setFace('neutral'), 800);
        }
    }

    function doWin() {
        playSound('win');
        document.querySelector('.btn-next').style.display = 'block';
        document.querySelector('.btn-skip').style.display = 'none';
        document.getElementById('mr-brush').classList.add('jumping');
        fireFireworksSeries();
    }

    function nextLevel() {
        currentIdx++;
        if (currentIdx >= words.length) showVictory();
        else { 
            document.getElementById('mr-brush').classList.remove('jumping');
            initLevel(); 
        }
    }
    
    function skipLevel() { nextLevel(); }

    function showVictory() {
        document.getElementById('board').style.display = 'none';
        document.getElementById('char-container').style.display = 'none';
        document.getElementById('victory-screen').style.display = 'flex';
        setInterval(() => createExplosion(Math.random()*1920, Math.random()*1080), 500);
    }

    function setFace(mood) {
        const mouth = document.getElementById('mouth');
        if(mood === 'happy') mouth.setAttribute('d', 'M40,85 Q50,95 60,85');
        else if(mood === 'sad') mouth.setAttribute('d', 'M40,90 Q50,80 60,90');
        else mouth.setAttribute('d', 'M40,85 Q50,90 60,85');
    }

    // --- –ï–§–ï–ö–¢–ò –ö–û–ù–§–ï–¢–¢–Ü ---
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function createExplosion(x, y) {
        for (let i = 0; i < 30; i++) {
            particles.push({
                x, y, vx: Math.random()*10-5, vy: Math.random()*10-5,
                c: baseColors[Math.floor(Math.random()*baseColors.length)].hex,
                life: 1, gravity: 0.2
            });
        }
        updateParticles();
    }
    function updateParticles() {
        ctx.clearRect(0,0,1920,1080);
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.life -= 0.02;
            ctx.fillStyle = p.c; ctx.beginPath(); ctx.arc(p.x, p.y, 5*p.life, 0, 7); ctx.fill();
            if(p.life <= 0) particles.splice(i, 1);
        });
        if(particles.length > 0) requestAnimationFrame(updateParticles);
    }
    function fireFireworksSeries() {
        for(let i=0; i<5; i++) setTimeout(() => createExplosion(Math.random()*1400+260, Math.random()*600+100), i*300);
    }

    // –ó–∞–ø—É—Å–∫
    initTrialEffects();
    initLevel();
</script>

</body>
</html>